"use strict";var CookieUtil={config:{domain:"product"==nodeEnv?".xthinking.net":"",expires:7},set:function(e,t,i){if($.cookie(e,t,{expires:i||this.config.expires,path:"/",domain:this.config.domain}),"Authorization"==e){var o=new Date;o.setDate(o.getDate()+7),CookieUtil.remove("expires"),CookieUtil.set("expires",o.getTime())}},remove:function(e){$.cookie(e,null,{expires:-1,path:"/",domain:this.config.domain}),"Authorization"!=e&&"expires"!=e||$.cookie(e,null,{expires:-1,path:"/",domain:""})}},VideoToken={get:function(){var e=$.cookie("Authorization"),t=$.cookie("videoToken");e&&null!=e?t&&null!=t||this.send():isWeixin()?location.href=ctx+"/user/wx/gzLogin?repage="+location.href:location.href=ctx+"/user/login?repage="+location.href},send:function(){var e={url:ctx+"/api/user/videoToken",data:{},callBack:function(e){"200"==e.code&&CookieUtil.set("videoToken",e.data,1)}};CMC.send(e)},remove:function(){CookieUtil.remove("Authorization"),CookieUtil.remove("videoToken"),localStorage.removeItem("UserInfo"),location.reload()},removeVideoToken:function(){CookieUtil.remove("videoToken")}},Domain={base:ctx,ali:"alioss-app-client1.mfcode.net",qiniu:"naotu.xthinking.net"},clientServer="http://s.mfcode.net",ssoServerLogin="http://api.xthinking.net:80/sso/?redirectUrl="+encodeURIComponent("http://127.0.0.1:3000/index"),Service={CheckAuthUrl:"http://api.xthinking.net:80/sso/checkAuth",Appointment:{isExist:clientServer+"/client/appointment/isExist",vipcourse:clientServer+"/client/appointment/vipcourse"},Material:{list:clientServer+"/client/material/list",categories:clientServer+"/client/material/categories"},User:{vipList:Domain.base+"/api/user/course/viplist",pvtList:Domain.base+"/api/user/pvt/list",orderList:Domain.base+"/api/user/order/list",couponList:Domain.base+"/api/user/coupon/list",worksList:Domain.base+"/api/user/pvt/works/list",hasAudition:Domain.base+"/api/listen/hasAudition",info:Domain.base+"/api/user/info",updateInfo:Domain.base+"/api/user/updateInfo",changePwd:Domain.base+"/api/user/changePwd",setAvatar:Domain.base+"/api/user/setAvatar"},Order:{cancel:Domain.base+"/api/order/cancel",repay:Domain.base+"/api/order/repay"},Account:{login:Domain.base+"/user/loginSubmit",reg:Domain.base+"/user/regSubmit"},Validate:{Login:{getCaptcha:Domain.base+"/api/vcode/unauth/login"},Reg:{getCaptcha:Domain.base+"/api/vcode/unauth/reg",validateCaptcha:Domain.base+"/api/msm/validateMobile/reg",getMsm:Domain.base+"/api/msm/send/reg",validateMsm:Domain.base+"/api/sso/reg"},ChangePwd:{getCaptcha:Domain.base+"/api/vcode/unauth/changepwd",validateCaptcha:Domain.base+"/api/msm/validateMobile/changepwd",getMsm:Domain.base+"/api/msm/send/changepwd",validateMsm:Domain.base+"/api/sso/changepwd"},WxOpenBindMobile:{getCaptcha:Domain.base+"/api/vcode/unauth/wxOpenBindMobile",validateCaptcha:Domain.base+"/api/msm/validateMobile/wxOpenBindMobile",getMsm:Domain.base+"/api/msm/send/wxOpenBindMobile",validateMsm:Domain.base+"/api/sso/wxOpenBindMobile"},GzBindMobile:{getCaptcha:Domain.base+"/api/vcode/unauth/gzBindMobile",validateCaptcha:Domain.base+"/api/msm/validateMobile/gzBindMobile",getMsm:Domain.base+"/api/msm/send/gzBindMobile",validateMsm:Domain.base+"/api/sso/gzBindMobile"}}},productMap={payType:[{id:0,name:"未支付"},{id:1,name:"已支付"}]},Consts={CodeLang:{Scratch:"scratch",JavaScript:"javaScript",Python:"python",Cplusplus:"c++"},CodeLangBg:{scratch:"http://qiniu.img.webvideo.xthinking.net/kaixin1.jpg",javaScript:"http://qiniu.img.webvideo.xthinking.net/Javascript1-5.png",python:"http://qiniu.img.webvideo.xthinking.net/python1-6.png","c++":"http://qiniu.img.webvideo.xthinking.net/c++01.png"},CodeLangQQ:{scratch:"2355479005",javaScript:"1603613148",python:"2851105095","c++":"1603613148"},MobileReg:/(^1[3|4|5|6|7|8|9]\d{9}$)|(^0\d{2,3}-?\d{7,8}$)/},ComElement={loaddingImg:'<img class="loaddingImg" src="/static/images/img/loading.gif" alt="">',eleDataNull:'<div style="display: block;margin-bottom: 100px"><img style="display: block;margin: 0 auto;" src="'+ctxStatic+'/official/1.0/pc/images/error/not_course.png"><p style="margin-top: 10px;font-size: 16px;color: #8c9499;text-align: center;">记录空空如也，您还没购买精品课程</p></div>'},LoginModule={loginModule:"",validateOptions:[{name:"username",rule:{regex:/(^1[3|5|7|8|9]\d{9}$)|(^0\d{2,3}-?\d{7,8}$)/,msg:"手机号码格式错误"}},{name:"password",length:{min:6,max:18,msg:"密码长度应为6-18个字符"}}],content:'<div class="login"> <div class="login-box"> <div class="login-title"> <div class="login-text active"><a href="#">登录</a></div> <div class="close-btn login-close"></div> </div> </div> <div class="login-content"> <form action="#" id="loginForm" onsubmit="return validateForm();" autocomplete="off"> <div class="validate-group"> <input type="text" name="username" class="validate-control login-phone" placeholder="手机号" maxlength="11"> <div class="error-tip"></div> </div> <div class="validate-group"> <input type="password" name="password" class="validate-control login-pwd" placeholder="密码" maxlength="18" minlength="4"> <div class="error-tip"></div> </div> <div class="verification-code" id="loginVcode" style="display: none;"><input type="text" class="verCode-input" name="kaptcha" placeholder="验证码"><div class="verCode-box" style="margin-top: 0;"><img src="" class="validateLoginCode"></div></div><div class="login-err">账号或密码错误</div> <div class="nextLogin-findPwd"> <div class="find-pwd" id="regAcc">账号注册</div></div> <input type="button" class="login-btn" id="loginBtn" value="登录"> </form> </div> ',show:function(){this.loginModule=layer.open({type:1,title:!1,closeBtn:0,shadeClose:!1,content:this.content,area:"auto",offset:"170px",btnAlign:"c",scrollbar:!1,resize:!1,cancel:function(e,t){return confirm("确定要关闭么")&&layer.close(e),!1}}),$("#regAcc").on("click",function(){location.href=ssoServerUrl+"/html/register?redirectUrl="+window.location.href.split("?")[0]}),$(".login-wechat").hover(function(){$(this).children("img").attr("src",ctxStatic+"/official/1.0/pc/images/user/wechat_green.png")},function(){$(this).children("img").attr("src",ctxStatic+"/official/1.0/pc/images/user/wechat_gray.png")}),$(".login-wechat").on("click",function(){window.open(ctx+"/user/wx/openLogin?t="+(new Date).getTime(),"_blank")});var e=this;$(".close-btn").click(function(){e.hide()}),$("#loginForm .validate-control").on("blur",function(){Validate.valid($(this),e.validateOptions)}),$("#loginForm .validate-control").on("focus",function(){Validate.hideErrorTip(this)}),$(".error-tip").on("click",function(){var e=$(this).parent().find(".validate-control");Validate.hideErrorTip(e),e.focus()}),$(".validateLoginCode").on("click",function(){getLoginCode()}),$("#loginBtn").on("click",function(){userLogin(this,!0)})},hide:function(){layer.close(this.loginModule)}};document.onkeydown=function(e){var t=e||window.event;t&&13==t.keyCode&&$("#loginBtn").click()};var loginModuleCallBack=function(){LoginModule.hide(),layer.alert("登录成功",function(e){layer.close(e),location.reload()})};layer.config({skin:"my-skin"});var CMC={config:{type:"post",dataType:"json",asy:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8"},data:{url:"url",data:"data",callBack:"callBack",element:"element",msg:"msg"},getConfig:function(e){(null==(e=e||{}).type&&(e.type=this.config.type),null==e.dataType&&(e.dataType=this.config.dataType),null==e.asy&&(e.asy=this.config.asy),e.withoutHeader)?e.headers={}:($.cookie("Authorization")||checkAuth(Service.CheckAuthUrl,function(e){},!0),e.headers={Authorization:decodeURIComponent($.cookie("Authorization"))?decodeURIComponent($.cookie("Authorization")):""});return e},send:function(e,t){return this.postData(e||{},this.getConfig(t))},postData:function(o,t){var i={};return $.ajax({type:t.type,url:o.url+"?tm="+(new Date).getTime(),headers:t.headers,crossDomain:!0,xhrFields:{withCredentials:!0},data:o.data,dataType:t.dataType,contentType:t.contentType||this.config.contentType,cache:!1,async:t.asy,elememt:"",timeout:5e3,beforeSend:function(e){},success:function(e){if("5009"!=e.code)if(null!=o.callBack&&""!=o.callBack){if("403"==e.code)return CookieUtil.remove("Authorization"),CookieUtil.remove("expires"),localStorage.removeItem("UserInfo"),localStorage.removeItem("MatchStroage"),void(isMoblie()||layer.confirm("登录身份过期，请重新登录",function(e){layer.close(e),e&&(location.href=ctx+"/user/login?repage="+location.href)}));t.asy?o.callBack(e):(o.callBack(e),i=e||{})}else i=e;else layer.alert("系统繁忙，请稍后重试")},error:function(e,t,i){if(console.log("exception :",JSON.stringify(i)),console.log("readyState :",e.readyState),console.log("errInfo :"+t),null!=o.callBack&&""!=o.callBack)if("timeout"===t)o.callBack({success:!1,errcode:t,msg:"发送数据失败，请求超时，请重试"});else if("error"==t){if(0==e.readyState)return void o.callBack({success:!1,errcode:t,msg:"发送数据失败，请检查您的网络"});"Not Found"===i?o.callBack({success:!1,errcode:t,msg:"发送数据失败，请求不存在"}):o.callBack({success:!1,errcode:t,msg:"发送数据失败,服务器响应错误。"})}else o.callBack({success:!1,msg:"发送数据失败，请稍后重试。"});else alert("发送数据失败。")},complete:function(e,t){}}),i}},ReqBinary=function(e,i){this.config={url:e.url,type:e.type?e.type:"GET"};var t=new XMLHttpRequest;t.open(this.config.type,this.config.url,!0),e.authorization&&t.setRequestHeader("Authorization",decodeURIComponent($.cookie("Authorization"))?decodeURIComponent($.cookie("Authorization")):""),t.responseType="blob",t.onload=function(){if(200==this.status){var e=this.response,t=document.createElement("img");t.onload=function(e){window.URL.revokeObjectURL(t.src)},t.src=window.URL.createObjectURL(e),null!=i&&""!=i&&i(t.src)}},t.send()},Validate={res:{},options:{},validateLogin:"",mobile:function(e){return/(^1[3|4|5|6|7|8|9]\d{9}$)|(^0\d{2,3}-?\d{7,8}$)/.test(e)||(this.res={flag:!1,msg:"手机号码格式错误"}),this.res},password:function(e){(e.length<6||18<e.length)&&(this.res={flag:!1,msg:"密码长度应为6-18个字符"})},valid:function(e,t){this.res={flag:!0,msg:""};for(var i=e.attr("name"),o=e.val(),n=0;n<t.length;n++)if(i==t[n].name){if(this.options=t[n],this.options.rule&&this.options.rule.regex&&(this.validReg(o,this.options.rule),!this.res.flag))return void this.dealErrorTip(e);if(this.options.length&&(this.options.length.min||this.options.length.max)&&(this.validLen(o,this.options.length),!this.res.flag))return void this.dealErrorTip(e);if(this.options.equal&&this.options.equal.name){i=this.options.equal.name;var a=e.parent().parent().find("input[name="+i+"]").val();if(this.validEqual(o,a,this.options.equal),!this.res.flag)return void this.dealErrorTip(e)}return}},submitValid:function(e,t){var i=this,o=!0;return t&&$(e+" .validate-control").each(function(){i.valid($(this),t)}),$(e+" .error-tip").each(function(){"none"!=$(this).css("display")&&(o=!1)}),o},dealErrorTip:function(e){$(e).parent().find(".error-tip")&&(this.res.flag?this.hideErrorTip(e):this.showErrorTip(e))},showErrorTip:function(e){$(e).parent().find(".error-tip").css({display:"block"}),$(e).parent().find(".error-tip").text(this.res.msg),$(e).css("border","1px solid #f75653")},hideErrorTip:function(e){$(e).parent().find(".error-tip").css({display:"none"}),$(e).css("border","1px solid #edf0f2")},validReg:function(e,t){t.regex.test(e)||(this.res={flag:!1,msg:t.msg})},validLen:function(e,t){var i=!1,o=this.getByteLen(e);t.min&&t.max?o>=t.min&&o<=t.max&&(i=!0):t.min?o>=t.min&&(i=!0):t.max&&o<=t.max&&(i=!0),0==i&&(this.res={flag:i,msg:t.msg})},validEqual:function(e,t,i){e!=t&&(this.res={flag:!1,msg:i.msg})},getByteLen:function(e){for(var t=0,i=0;i<e.length;i++){null!=e.charAt(i).match(/[^\x00-\xff]/gi)?t+=2:t+=1}return t}};function formString2JsonData(e){if(null==e)return{};for(var t=e.split("&"),i="{",o=0;o<t.length;o++){var n=t[o].split("=");o!=t.length-1?i+='"'+n[0]+'":"'+n[1]+'",':i+='"'+n[0]+'":"'+n[1]+'"}'}return JSON.parse(i)}var validateLogin=[{name:"username",rule:{regex:Consts.MobileReg,msg:"手机号码格式错误"}},{name:"password",length:{min:6,max:18,msg:"密码长度应为6-18个字符"}}],userLogin=function(i,o){$(".login-err").css("display","none");var e=$("#loginForm").serialize().replace(/\+/g," "),t=formString2JsonData(e=decodeURIComponent(e,!0));if(t.identityType=2,Validate.submitValid("#loginForm",validateLogin)){isMoblie()&&mui(i).button("loading");var n={url:ssoServerUrl+"api/login",data:t,callBack:function(e){if("200"==e.code){isMoblie()&&mui.toast("登陆成功,正在跳转...",{duration:"10000",type:"div"});var t="Bearer "+e.data;CookieUtil.set("Authorization",t),o?loginModuleCallBack():getUserInfo()}else"700"==e.code?$(".login-err").css("display","block"):"801"==e.code?(getLoginCode(),$("#loginVcode").show(),$(".login-err").text("验证码或密码错误"),$(".login-err").css("display","block")):"00002"==e.code?(getLoginCode(),$("#loginVcode").show(),$(".login-err").text("验证码错误"),$(".login-err").css("display","block")):e.success||isMoblie()&&mui.alert(""+e.msg,"","确定",function(){mui(i).button("reset")},"div");isMoblie()&&mui(i).button("reset")}};CMC.send(n,{withoutHeader:!0})}},imgLoginToken="";function getLoginCode(){$(".validateLoginCode").attr("src",ssoServerUrl+"kaptcha?"+(new Date).getTime())}var getUserInfo=function(){userInfoCallBack({})};function timestampToFullDate(e){10==e.length&&(e*=1e3);var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())}function timestampToDate(e){10==e.length&&(e*=1e3);var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())}function compare(i){return function(e,t){return e[i]-t[i]}}function fontSize(){var e=640<document.documentElement.clientWidth?640:document.documentElement.clientWidth;document.documentElement.style.fontSize=e/12.42+"px"}function getCode(e,t,i){if("function"==typeof i){var o=localStorage.getItem("CodeExpires")?localStorage.getItem("CodeExpires"):"";if(o&&"undefined"!=o){var n=(new Date).getTime();if(6e4<n-o)i(e,t);else{var a=parseInt((6e4-(n-o))/1e3);error.show("请"+a+"s后再重新获取。")}}else i(e,t)}}function getCodeActSuc(){var e=(new Date).getTime();localStorage.setItem("CodeExpires",e),$(".send-code").text("60s后重新获取"),$(".send-code").css("cursor","not-allowed");var t=60;e=setInterval(function(){0<t?(t--,$(".send-code").text(t+"s后重新获取")):(clearInterval(e),$(".send-code").text("发送验证码"),$(".send-code").css("cursor","pointer"))},1e3)}function isWeixin(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}function isMoblie(){return!!/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)}function isMac(){return-1!=navigator.userAgent.toLowerCase().indexOf("mac os")}function showTip(e){e||error.show("请关闭浏览器的弹出窗口过滤")}function checkAuthor(){var e=$.cookie("Authorization");if(e&&null!=e){var t=$.cookie("expires");if(t&&null!=t)t-(new Date).getTime()<432e5&&reGetAuthor()}}function reGetAuthor(){var e=$.cookie("Authorization");if(e){e=e.split(" ")[1];var t={url:ssoServerUrl+"changeGlobalAuthToken",data:{token:e},callBack:function(e){if("200"==e.code){var t="Bearer "+e.data;CookieUtil.set("Authorization",t)}}};CMC.send(t,{withoutHeader:!0})}}function downloadWorks(e){$("#downloadWorks").remove();var t='<a href="'+e+'" hidden id="downloadWorks"><span id="spanId">download</span></a>';$("body").append(t),setTimeout(function(){$("#spanId").click()})}var localData={setData:function(e,t){localStorage.setItem(e,t)},getData:function(e){return localStorage.getItem(e)},removeData:function(e){localStorage.removeItem(e)},isExpires:function(e,t,i){var o=(new Date).getTime(),n=this.getData(t);return(!n||o-parseInt(n)>i)&&(this.removeData(e),this.removeData(t),!0)}},MatchStroageModal={id:"",groupType:"",currScheduleId:"",matchHtml:"",fileId:"",sname:"",uploadToken:"",isUploaded:""};function checkAuth(e,i,o){var t={url:e,data:{},callBack:function(e){if("600"==e.code)isWeixin()||o||LoginModule.show();else{var t="Bearer "+e.data;CookieUtil.set("Authorization",t)}i(e)}};CMC.send(t,{withoutHeader:!0,asy:!1})}function getFileContent(e,i){i=i?i+"."+getFileSuffix(e):getFileName(e);var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/json"),o.responseType="blob",o.onload=function(){var e=o.response,t=new Blob([e],{type:"application/octet-stream"});saveAs(t,i)},o.send()}function getFileName(e){var t=(e=decodeURIComponent(e)).split("/");return t=t[t.length-1]}function getFileSuffix(e){var t=(e=decodeURIComponent(e)).split(".");return t=t[t.length-1]}function toTree(e){e.forEach(function(e){delete e.children});var i={};e.forEach(function(e){i[e.id]=e}),console.log(i);var o=[];return e.forEach(function(e){var t=i[e.parentId];t?(t.children||(t.children=[])).push(e):o.push(e)}),o}var HtmlUtil={htmlEncode:function(e){var t=document.createElement("div");null!=t.textContent?t.textContent=e:t.innerText=e;var i=t.innerHTML;return t=null,i},htmlDecode:function(e){var t=document.createElement("div");t.innerHTML=e;var i=t.innerText||t.textContent;return t=null,i},htmlEncodeByRegExp:function(e){return 0==e.length?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},htmlDecodeByRegExp:function(e){return 0==e.length?"":e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')}},Base64={utf16to8:function(e){var t,i,o,n;for(t="",o=e.length,i=0;i<o;i++)1<=(n=e.charCodeAt(i))&&n<=127?t+=e.charAt(i):(2047<n?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63)):t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|n>>0&63));return t},utf8to16:function(e){var t,i,o,n,a,r;for(t="",o=e.length,i=0;i<o;)switch((n=e.charCodeAt(i++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(i-1);break;case 12:case 13:a=e.charCodeAt(i++),t+=String.fromCharCode((31&n)<<6|63&a);break;case 14:a=e.charCodeAt(i++),r=e.charCodeAt(i++),t+=String.fromCharCode((15&n)<<12|(63&a)<<6|(63&r)<<0)}return t}},loading={show:function(e){var t=document.createElement("div");t.setAttribute("class","loading");var i="<img src="+ctxStatic+'/official/1.0/pc/images/error/loading.gif alt="">';$(t).append(i),$("."+e).append(t)},hide:function(){$(".loading").remove()}},error={errorShow:"",show:function(e){this.errorShow=layer.open({type:1,title:!1,closeBtn:0,shadeClose:!1,content:'<div class="error-title">\n            <div class="error-img"><img src="'+ctxStatic+'/official/1.0/pc/images/error/error.png" alt=""></div>\n            <div class="error-text">'+e+'</div>\n        </div>\n        <div class="error-btn">确认</div>',area:["394px","166px"],offset:"218px",scrollbar:!1,resize:!1});var t=this;$(".error-btn").on("click",function(e){t.hide(),e.stopPropagation()})},hide:function(){layer.close(this.errorShow)}},StatusCode={codeArr:[{code:"00002",msg:"验证码错误"},{code:"2000",msg:"参数非法请求"},{code:"2002",msg:"短信验证码凭证失效，请刷新页面重试"},{code:"2003",msg:"今天短信验证码请求次数过多"},{code:"3001",msg:"密码格式不正确"},{code:"4001",msg:"已存在该账号，请直接登陆"},{code:"3002",msg:"不存在该账号"},{code:"5003",msg:"该手机已被绑定"}],getMsgByCode:function(e){for(i in this.codeArr)if(this.codeArr[i].code==e)return this.codeArr[i].msg;return"请求失败"}};